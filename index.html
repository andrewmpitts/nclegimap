<html>
<head>
    <title>NC General Assembly Map</title>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="representatives/ncCongressReps.js"></script>
    <link rel="stylesheet" type="text/css" href="style/generalStyle.css">
</head>
<body>
<!--<h1 id = 'demo'></h1>-->
<div class = "mapNavbar">
    <span id = "repMapToggle" class = "mapToggle" onclick = "toggleMap('rep')">NC House of Representatives Districts</span>
    <span id = "senMapToggle" class = "mapToggle" onclick = "toggleMap('sen')">NC Senate Districts</span>
    <span id = "congressMapToggle" class = "mapToggle" onclick = "toggleMap('con')">NC Congressional Districts</span>
    <!--<span id = "dcSenMapToggle"></span>-->
</div>
<hr>
<div class = "mapContainer" style = "width: 1203px; height: auto; display: inline-block;">
    <svg id="ncRepMap" width="900" height="450" style="border: 1px solid black;"></svg>
    <div class = "mapContextContainer" style = "left: 900px; top: 0px; width: 300px; height: 450px; display: inline-block; border-right-width: 1px; border-right-color: black; border-right-style: solid; border-top-width: 1px; border-top-color: black; border-top-style: solid; border-bottom-width: 1px; border-bottom-color: black; border-bottom-style: solid; float: right;">
        <p class="repName" id="repNameText" style="text-align: center; margin: auto; padding: 5px; width: 100%;">Representative Name</p>
        <hr>
        <div class="infoContainer">
            <p id="districtText" class="infoText"></p>
            <p id="partyText" class="infoText"></p>
            <a id="nclegURLText" class="infoText"></a>
            <a id="emailLink" class="infoText"></a>
        </div>
        <!--<div class="photoContainer">-->
            <!--<img id = "repPhoto" class = "photo">-->
        <!--</div>-->
        <div class="addressContainer">
            <div class = "leftAddressContainer">
                <p id = "localAddress" class = "localAddress address"></p>
            </div>
            <div class = "rightAddressContainer">
                <p id = "capitalAddress" class = "capitalAddress address"></p>
            </div>
        </div>
    </div>
    <!--<div class="mapContextContainer" style="left: 900px; top: 0px; width: 300px; height: 450px; display: inline-block; border-right-width: 1px; border-right-color: black; border-right-style: solid; border-top-width: 1px; border-top-color: black; border-top-style: solid; border-bottom-width: 1px; border-bottom-color: black; border-bottom-style: solid;"></div>-->
</div>
<script>
    var openStatesURL = "https://openstates.org/api/v1/METHOD/";
    var ncMetadataURL = "openstates.org/api/v1/metadata/nc/";
    var ncLegislatorsURL = "https://openstates.org/api/v1/legislators/?state=nc";
    var ncSenateURL = "https://openstates.org/api/v1/legislators/?state=nc&chamber=upper";
    var ncRepURL = "https://openstates.org/api/v1/legislators/?state=nc&chamber=lower";
    var billLookupURL = "https://openstates.org/api/v1/bills/NCB00010747/";
    var hb2BillURL = "https://openstates.org/api/v1/bills/NCB00009985/"; //Detailed bill example
    var billLookupURL = "openstates.org/api/v1/bills/?state=nc&q=" //+ query
    var ncCongressURL = "http://apitts.com/"
    var billIds = [];

    var width = 900, height = 450;

    var svgSenMap = d3.select( "body" )
            .append( "svg" )
            .attr( "id", "ncSenMap")
            .attr( "width", width )
            .attr( "height", height );

    var svgCongressMap = d3.select( "body" )
            .append( "svg" )
            .attr( "id", "ncSenMap")
            .attr( "width", width )
            .attr( "height", height );

    var svgHB2Map = d3.select( "body" )
            .append( "svg" )
            .attr( "id", "ncSenMap")
            .attr( "width", width )
            .attr( "height", height );

    var gr = d3.select("#ncRepMap").append( "g" );
    var gs = svgSenMap.append( "g" );
    var gCon = svgCongressMap.append( "g" );
    var ghb2 = svgHB2Map.append( "g" );

    var albersProjection = d3.geo.albersUsa()
            .scale(7000)
//            .rotate( [71.057,0] )
//            .center( [0, 42.313] )
            .translate( [-1200, -40] );

    var geoPath = d3.geo.path()
            .projection( albersProjection );

    var republicanColor = "#DB1F1E";
    var democratColor = "#1840DE";
    var independentColor = "#AAADAD";
//    console.log(ncCongressReps);
//    d3.json("ncsgeo/ncrepdistrictsmin.json", function (json) {
//        console.log(json);
//        gr.selectAll("path")
//                .data(json.features)
//                .enter()
//                .append("path")
//                .attr("fill", "#ffffff")
//                .attr("stroke", "#888888")
//                .each(function(d, i) {
//                    var district = d.properties.District;
//                    d3.select(this)
//                        .attr("id", "d" + district)
//                        .attr("onmouseover", 'd3.select(d' + district + ').attr("fill", "' + democratColor + '")')
//                        .attr("onclick", "console.log(" + district + ")")
//                        .attr("onmouseout", 'd3.select(d' + district + ').attr("fill", "#ffffff")');
//            })
//                .attr("d", geoPath);
//    });

//    d3.json("ncsgeo/ncsendistrictsmin.json", function (json) {
//        console.log(json);
//        gs.selectAll("path")
//                .data(json.features)
//                .enter()
//                .append("path")
//                .attr("fill", "#ffffff")
//                .attr("stroke", "#888888")
//                .each(function(d, i) {
//                    var district = d.properties.District;
//                    d3.select(this)
//                            .attr("id", "s" + district)
//                            .attr("onmouseover", 'd3.select(s' + district + ').attr("fill", "' + democratColor + '")')
//                            .attr("onclick", "console.log(" + district + ")")
//                            .attr("onmouseout", 'd3.select(s' + district + ').attr("fill", "#ffffff")');
//                })
//                .attr("d", geoPath);
//    });

//    d3.json("ncsgeo/ncdccongressdistrictsmin.json", function (json) {
//        console.log(json);
//        gCon.selectAll("path")
//                .data(json.features)
//                .enter()
//                .append("path")
//                .attr("fill", "#ffffff")
//                .attr("stroke", "#888888")
//                .each(function(d, i) {
//                    var district = d.properties.District;
//                    d3.select(this)
//                            .attr("id", "con" + district)
//                            .attr("onmouseover", 'd3.select(con' + district + ').attr("fill", "' + democratColor + '")')
//                            .attr("onclick", "console.log(" + district + ")")
//                            .attr("onmouseout", 'd3.select(con' + district + ').attr("fill", "#ffffff")');
//                })
//                .attr("d", geoPath);
//    });


//    console.log(JSON.parse(md));

    function getPartyColor(partyString) {
        if (partyString == "D" || partyString == "Democrat" || partyString == "Democratic") {
            return democratColor;
        }
        else if (partyString == "R" || partyString == "Republican") {
            return republicanColor;
        }
        else {
            return independentColor;
        }
    }

    function displayRepData(rep) {
        document.getElementById("repNameText").innerHTML = rep.rep;
        document.getElementById("emailLink").innerHTML = rep.email;
        document.getElementById("emailLink").href = rep.email;
        document.getElementById("districtText").innerHTML = rep.district;
        document.getElementById("partyText").innerHTML = rep.party;
        document.getElementById("nclegURLText").innerHTML = "Represenative's NC Legislature Page";
        document.getElementById("nclegURLText").href = rep.ncLegURL;
//        document.getElementById("repPhoto").src = rep.photoURL;
        document.getElementById("localAddress").innerHTML = rep.offices[0].address;
        document.getElementById("capitalAddress").innerHTML = rep.offices[1].address;
    }

    function displaySenData(rep) {
        document.getElementById("repNameText").innerHTML = rep.rep;
        document.getElementById("emailLink").innerHTML = rep.email;
        document.getElementById("emailLink").href = rep.email;
        document.getElementById("districtText").innerHTML = rep.district;
        document.getElementById("partyText").innerHTML = rep.party;
        document.getElementById("nclegURLText").innerHTML = "Represenative's NC Legislature Page";
        document.getElementById("nclegURLText").href = rep.ncLegURL;
//        document.getElementById("repPhoto").src = rep.photoURL;
        document.getElementById("localAddress").innerHTML = rep.offices[0].address;
        document.getElementById("capitalAddress").innerHTML = rep.offices[1].address;
    }

    function getRepData() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                var repJSON = JSON.parse(this.responseText);
                var repModel = {};
                console.log(repJSON);
                repJSON.forEach(function(rep){
                    repModel[rep.district] = {
                        "party": rep.party,
                        "rep": rep.full_name,
                        "id": rep.leg_id,
                        "level": rep.level,
                        "offices": rep.offices,
                        "photoURL": rep.photo_url,
                        "ncLegURL": rep.url,
                        "email": rep.email,
                        "chamber": rep.chamber,
                        "active": rep.active,
                        "district": rep.district,
                        "nimspCandID": rep.nimsp_candidate_id,
                        "nimspID": rep.nimsp_id
                    };

                });
                d3.json("ncsgeo/ncrepdistrictsmin.json", function (json) {
                    gr.selectAll("path")
                            .data(json.features)
                            .enter()
                            .append("path")
                            .attr("stroke", "#222222")
                            .each(function(d, i) {
                                var district = d.properties.District;
//                                console.log(repModel[district])
                                d3.select(this)
                                        .attr("id", "r" + district)
                                        .attr("fill", getPartyColor(repModel[district].party));
//                                        .attr("onmouseover", 'd3.select(d' + district + ').attr("fill", "' + democratColor + '")')
//                                        .attr("onclick", function(){displayRepData(repModel[district])});
                                document.getElementById("r" + district).onclick = function(){displayRepData(repModel[district])};
//                                        .attr("onmouseout", 'd3.select(d' + district + ').attr("fill", "#ffffff")');
                            })
                            .attr("d", geoPath);
                });
//                console.log(repModel);

            }
        };
        xhttp.open("GET", ncRepURL, true);
        xhttp.send();
    }
    getRepData();

    function getSenData() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                var senJSON = JSON.parse(this.responseText);
                var senModel = {};
                senJSON.forEach(function(sen){
                    senModel[sen.district] = {
                        "party": sen.party,
                        "senator": sen.full_name,
                        "id": sen.leg_id,
                        "level": sen.level,
                        "offices": sen.offices,
                        "photoURL": sen.photo_url,
                        "ncLegURL": sen.url,
                        "email": sen.email,
                        "chamber": sen.chamber,
                        "active": sen.active,
                        "district": sen.district,
                        "nimspCandID": sen.nimsp_candidate_id,
                        "nimspID": sen.nimsp_id
                    };
                });

                d3.json("ncsgeo/ncsendistrictsmin.json", function (json) {
                    console.log(json);
                    gs.selectAll("path")
                            .data(json.features)
                            .enter()
                            .append("path")
//                            .attr("fill", "#888888")
                            .attr("stroke", "#000000")
                            .each(function(d, i) {
                                var district = d.properties.District;
                                d3.select(this)
                                        .attr("id", "s" + district)
                                        .attr("fill", getPartyColor(senModel[district].party))
//                                        .attr("onmouseover", 'd3.select(s' + district + ').attr("fill", "' + democratColor + '")')
                                        .attr("onclick", "console.log('" + senModel[district].rep + "')");
                                document.getElementById("s" + district).onclick = function(){displayRepData(repModel[district])};
//                                        .attr("onmouseout", 'd3.select(s' + district + ').attr("fill", "#ffffff")');
                            })
                            .attr("d", geoPath);
                });
            }
        };
        xhttp.open("GET", ncSenateURL, true);
        xhttp.send();
    }
    getSenData();

    function getRepCongressData() {
        var repCongressModel = {};
        ncCongressReps.results.forEach(function(rep){
            repCongressModel[rep.district] = {"party": rep.party, "rep": rep.name};
        });
        console.log(repCongressModel)
        d3.json("ncsgeo/ncdccongressdistrictsmin.json", function (json) {
            gCon.selectAll("path")
                    .data(json.features)
                    .enter()
                    .append("path")
                    .attr("stroke", "#222222")
                    .each(function(d, i) {
                        var district = d.properties.District;
                        d3.select(this)
                                .attr("id", "dcr" + district)
                                .attr("fill", getPartyColor(repCongressModel[district].party))
                                //                                        .attr("onmouseover", 'd3.select(d' + district + ').attr("fill", "' + democratColor + '")')
                                .attr("onclick", "console.log('" + repCongressModel[district].rep + "')")
//                                        .attr("onmouseout", 'd3.select(d' + district + ').attr("fill", "#ffffff")');
                    })
                    .attr("d", geoPath);
        });
    }

//    getRepCongressData();

//    features.properties.districts for district numbers

//    g.selectAll( "path" )
//            .data( neighborhoods_json.features )
////            .data( neighborhoods_json.geometries )
//            .enter()
//            .append( "path" )
//            .attr( "fill", "#ffffff" )
//            .attr("stroke", "#888888")
////            .each(function(d, i) {
////                d3.select(this)
//////                    .attr("id", countyNames[i])
////                        .attr("id", "c" + i)
////                        .attr("onmouseover", 'd3.select(c' + i + ').attr("fill", "' + democratColor + '")')
//////                        .attr("onmouseover", "console.log(countyNames[" + i + "])");
////                        .attr("onmouseout", 'd3.select(c' + i + ').attr("fill", "#ffffff")');
////
////            })
//            .attr( "d", geoPath );



//    var width  = 1400;
//    var height = 600;
//
//    var vis = d3.select("body").append("svg")
//            .attr("width", width).attr("height", height)
//
//    d3.json("ncsgeo/ncrepdistrictsmin.json", function(json) {
//        // create a first guess for the projection
//        var center = d3.geo.centroid(json)
//        var scale  = 150;
//        var offset = [width/2, height/2];
//        var projection = d3.geo.mercator().scale(scale).center(center)
//                .translate(offset);
//
//        // create the path
//        var path = d3.geo.path().projection(projection);
//
//        // using the path determine the bounds of the current map and use
//        // these to determine better values for the scale and translation
//        var bounds  = path.bounds(json);
//        var hscale  = scale*width  / (bounds[1][0] - bounds[0][0]);
//        var vscale  = scale*height / (bounds[1][1] - bounds[0][1]);
//        var scale   = (hscale < vscale) ? hscale : vscale;
//        var offset  = [width - (bounds[0][0] + bounds[1][0])/2,
//            height - (bounds[0][1] + bounds[1][1])/2];
//
//        // new projection
//        projection = d3.geo.mercator().center(center)
//                .scale(scale).translate(offset);
//        path = path.projection(projection);
//
//        // add a rectangle to see the bound of the svg
//        vis.append("rect").attr('width', width).attr('height', height)
//                .style('stroke', 'black').style('fill', 'none');
//        console.log(json)
//        vis.selectAll("path").data(json.features).enter().append("path")
//                .attr("d", path)
//                .style("fill", "white")
//                .style("stroke-width", "1")
//                .style("stroke", "black")
//    });





//    var width  = 1400;
//    var height = 600;
//
//    var vis = d3.select("body").append("svg")
//            .attr("width", width).attr("height", height)
//
//    d3.json("ncsgeo/ncrepdistrictsmin.json", function(json) {
//        // create a first guess for the projection
//        var center = d3.geo.centroid(json)
//        var scale  = 150;
//        var offset = [width/2, height/2];
//        var projection = d3.geo.mercator().scale(scale).center(center)
//                .translate(offset);
//
//        // create the path
//        var path = d3.geo.path().projection(projection);
//
//        // using the path determine the bounds of the current map and use
//        // these to determine better values for the scale and translation
//        var bounds  = path.bounds(json);
//        var hscale  = scale*width  / (bounds[1][0] - bounds[0][0]);
//        var vscale  = scale*height / (bounds[1][1] - bounds[0][1]);
//        var scale   = (hscale < vscale) ? hscale : vscale;
//        var offset  = [width - (bounds[0][0] + bounds[1][0])/2,
//            height - (bounds[0][1] + bounds[1][1])/2];
//
//        // new projection
//        projection = d3.geo.mercator().center(center)
//                .scale(scale).translate(offset);
//        path = path.projection(projection);
//
//        // add a rectangle to see the bound of the svg
//        vis.append("rect").attr('width', width).attr('height', height)
//                .style('stroke', 'black').style('fill', 'none');
//        console.log(json)
//        vis.selectAll("path").data(json.features).enter().append("path")
//                .attr("d", path)
//                .style("fill", "red")
//                .style("stroke-width", "1")
//                .style("stroke", "black")
//    });





//    console.log(

//    console.log(countyNames);


//    d3.select("path#c0").attr( "fill", "#220099" );

//console.log(neighborhoods_json.features[10]);
//            neighborhoods_json.features[0].properties.name
//    );
</script>
</body>
</html>