<html>
<head>
    <title>A D3 map</title>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="representatives/ncCongressReps.js"></script>
    <!--<script src="ncsgeomin.js"></script>-->
    <!--<script type="text/javascript" src="representatives/ncmetadata.json"></script>-->
</head>
<body>
<h1 id = 'demo'></h1>
<div class = "mapContainer" style = "width: 1203px; height: auto; display: inline-block;">

    <!--<div class="mapContextContainer" style="left: 900px; top: 0px; width: 300px; height: 450px; display: inline-block; border-right-width: 1px; border-right-color: black; border-right-style: solid; border-top-width: 1px; border-top-color: black; border-top-style: solid; border-bottom-width: 1px; border-bottom-color: black; border-bottom-style: solid;"></div>-->
</div>
<script>
    var openStatesURL = "https://openstates.org/api/v1/METHOD/";
    var ncMetadataURL = "openstates.org/api/v1/metadata/nc/";
    var ncLegislatorsURL = "https://openstates.org/api/v1/legislators/?state=nc";
    var ncSenateURL = "https://openstates.org/api/v1/legislators/?state=nc&chamber=upper";
    var ncRepURL = "https://openstates.org/api/v1/legislators/?state=nc&chamber=lower";
    var billLookupURL = "https://openstates.org/api/v1/bills/NCB00010747/";
    var hb2BillURL = "https://openstates.org/api/v1/bills/NCB00009985/"; //Detailed bill example
    var billLookupURL = "openstates.org/api/v1/bills/?state=nc&q=" //+ query
    var ncCongressURL = "http://apitts.com/"
    var billIds = [];

    var width = 900, height = 450;
//
    var svgRepMap = d3.select( ".mapContainer" )
            .append( "svg" )
            .attr( "id", "ncRepMap")
            .attr( "width", width )
            .attr( "height", height )
            .style("border", "1px black solid");
//            .style("grid-column-start", "1")
//            .style("grid-column-end", "span col4-start")
//            .style("grid-row-start", "2")
//            .style("grid-row-end", "span 2");

    d3.select(".mapContainer")
            .append("div")
            .attr("class", "mapContextContainer")
//            .attr("positon", "relative")
            .style("left", "900px")
            .style("top", "0px")
            .style("width", "300px")
            .style("height", "450px")
            .style("display", "inline-block")
            .style("border-right", "1px black solid")
            .style("border-top", "1px black solid")
            .style("border-bottom", "1px black solid")
            .style("float", "right");

    d3.select(".mapContextContainer")
            .append("p")
            .attr("class", "repName")
            .attr("id", "repNameText")
            .html("Hi");
//            .style("position", "relative")
//            .style("display", "inline-block")
//            .style("left", "50px")
//            .style("align", "center")
//            .style("margin", "auto")
//            .style("width", "200px");

    var svgSenMap = d3.select( "body" )
            .append( "svg" )
            .attr( "id", "ncSenMap")
            .attr( "width", width )
            .attr( "height", height );

    var svgCongressMap = d3.select( "body" )
            .append( "svg" )
            .attr( "id", "ncSenMap")
            .attr( "width", width )
            .attr( "height", height );

    var svgHB2Map = d3.select( "body" )
            .append( "svg" )
            .attr( "id", "ncSenMap")
            .attr( "width", width )
            .attr( "height", height );

    var gr = svgRepMap.append( "g" );
    var gs = svgSenMap.append( "g" );
    var gCon = svgCongressMap.append( "g" );
    var ghb2 = svgHB2Map.append( "g" );

    var albersProjection = d3.geo.albersUsa()
            .scale(7000)
//            .rotate( [71.057,0] )
//            .center( [0, 42.313] )
            .translate( [-1200,0] );

    var geoPath = d3.geo.path()
            .projection( albersProjection );

    var republicanColor = "#DB1F1E";
    var democratColor = "#1840DE";
    var independentColor = "#AAADAD";
    console.log(ncCongressReps);
//    d3.json("ncsgeo/ncrepdistrictsmin.json", function (json) {
//        console.log(json);
//        gr.selectAll("path")
//                .data(json.features)
//                .enter()
//                .append("path")
//                .attr("fill", "#ffffff")
//                .attr("stroke", "#888888")
//                .each(function(d, i) {
//                    var district = d.properties.District;
//                    d3.select(this)
//                        .attr("id", "d" + district)
//                        .attr("onmouseover", 'd3.select(d' + district + ').attr("fill", "' + democratColor + '")')
//                        .attr("onclick", "console.log(" + district + ")")
//                        .attr("onmouseout", 'd3.select(d' + district + ').attr("fill", "#ffffff")');
//            })
//                .attr("d", geoPath);
//    });

//    d3.json("ncsgeo/ncsendistrictsmin.json", function (json) {
//        console.log(json);
//        gs.selectAll("path")
//                .data(json.features)
//                .enter()
//                .append("path")
//                .attr("fill", "#ffffff")
//                .attr("stroke", "#888888")
//                .each(function(d, i) {
//                    var district = d.properties.District;
//                    d3.select(this)
//                            .attr("id", "s" + district)
//                            .attr("onmouseover", 'd3.select(s' + district + ').attr("fill", "' + democratColor + '")')
//                            .attr("onclick", "console.log(" + district + ")")
//                            .attr("onmouseout", 'd3.select(s' + district + ').attr("fill", "#ffffff")');
//                })
//                .attr("d", geoPath);
//    });

//    d3.json("ncsgeo/ncdccongressdistrictsmin.json", function (json) {
//        console.log(json);
//        gCon.selectAll("path")
//                .data(json.features)
//                .enter()
//                .append("path")
//                .attr("fill", "#ffffff")
//                .attr("stroke", "#888888")
//                .each(function(d, i) {
//                    var district = d.properties.District;
//                    d3.select(this)
//                            .attr("id", "con" + district)
//                            .attr("onmouseover", 'd3.select(con' + district + ').attr("fill", "' + democratColor + '")')
//                            .attr("onclick", "console.log(" + district + ")")
//                            .attr("onmouseout", 'd3.select(con' + district + ').attr("fill", "#ffffff")');
//                })
//                .attr("d", geoPath);
//    });


//    console.log(JSON.parse(md));

    function getPartyColor(partyString) {
        if (partyString == "D" || partyString == "Democrat" || partyString == "Democratic") {
            return democratColor;
        }
        else if (partyString == "R" || partyString == "Republican") {
            return republicanColor;
        }
        else {
            return independentColor;
        }
    }

    function displayRepData(rep) {
        document.getElementById("repNameText").innerHTML = rep;
    }

    function getRepData() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                var repJSON = JSON.parse(this.responseText);
                var repModel = {};
                repJSON.forEach(function(rep){
                    repModel[rep.district] = {"party": rep.party, "rep": rep.first_name + " " + rep.last_name};

                });
                d3.json("ncsgeo/ncrepdistrictsmin.json", function (json) {
                    gr.selectAll("path")
                            .data(json.features)
                            .enter()
                            .append("path")
                            .attr("stroke", "#222222")
                            .each(function(d, i) {
                                var district = d.properties.District;
                                d3.select(this)
                                        .attr("id", "r" + district)
                                        .attr("fill", getPartyColor(repModel[district].party))
//                                        .attr("onmouseover", 'd3.select(d' + district + ').attr("fill", "' + democratColor + '")')
                                        .attr("onclick", "displayRepData('" + repModel[district].rep + "')")
//                                        .attr("onmouseout", 'd3.select(d' + district + ').attr("fill", "#ffffff")');
                            })
                            .attr("d", geoPath);
                });
//                console.log(repModel);

            }
        };
        xhttp.open("GET", ncRepURL, true);
        xhttp.send();
    }
    getRepData();

//    function drawHB2Votes() {
//        var xhttp = new XMLHttpRequest();
//        xhttp.onreadystatechange = function() {
//            if (this.readyState == 4 && this.status == 200) {
//                var repJSON = JSON.parse(this.responseText);
//                console.log(repJSON);
//                var repModel = {};
//                repJSON.forEach(function(rep){
//                    repModel[rep.district] = {"party": rep.party, "rep": rep.first_name + " " + rep.last_name};
//
//                });
//                d3.json("ncsgeo/ncrepdistrictsmin.json", function (json) {
//                    ghb2.selectAll("path")
//                            .data(json.features)
//                            .enter()
//                            .append("path")
//                            .attr("stroke", "#222222")
//                            .each(function(d, i) {
//                                var district = d.properties.District;
//                                d3.select(this)
//                                        .attr("id", "r" + district)
//                                        .attr("fill", getPartyColor(repModel[district].party))
//                                        //                                        .attr("onmouseover", 'd3.select(d' + district + ').attr("fill", "' + democratColor + '")')
//                                        .attr("onclick", "console.log('" + repModel[district].rep + "')")
////                                        .attr("onmouseout", 'd3.select(d' + district + ').attr("fill", "#ffffff")');
//                            })
//                            .attr("d", geoPath);
//                });
////                console.log(repModel);
//
//            }
//        };
//        xhttp.open("GET", hb2BillURL, true);
//        xhttp.send();
//    }
//    drawHB2Votes();



    function getSenData() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                var senJSON = JSON.parse(this.responseText);
                var senModel = {};
                senJSON.forEach(function(sen){
                    senModel[sen.district] = {"party": sen.party, "rep": sen.first_name + " " + sen.last_name};

                });

                d3.json("ncsgeo/ncsendistrictsmin.json", function (json) {
                    console.log(json);
                    gs.selectAll("path")
                            .data(json.features)
                            .enter()
                            .append("path")
//                            .attr("fill", "#ffffff")
                            .attr("stroke", "#222222")
                            .each(function(d, i) {
                                var district = d.properties.District;
                                d3.select(this)
                                        .attr("id", "s" + district)
                                        .attr("fill", getPartyColor(senModel[district].party))
//                                        .attr("onmouseover", 'd3.select(s' + district + ').attr("fill", "' + democratColor + '")')
                                        .attr("onclick", "console.log('" + senModel[district].rep + "')")
//                                        .attr("onmouseout", 'd3.select(s' + district + ').attr("fill", "#ffffff")');
                            })
                            .attr("d", geoPath);
                });

//                d3.json("ncsgeo/ncrepdistrictsmin.json", function (json) {
//                    gr.selectAll("path")
//                            .data(json.features)
//                            .enter()
//                            .append("path")
//                            .attr("stroke", "#222222")
//                            .each(function(d, i) {
//                                var district = d.properties.District;
//                                d3.select(this)
//                                        .attr("id", "d" + district)
//                                        .attr("fill", repModel[district].party == "Democratic" ? democratColor : republicanColor)
//                                        //                                        .attr("onmouseover", 'd3.select(d' + district + ').attr("fill", "' + democratColor + '")')
//                                        .attr("onclick", "console.log('" + repModel[district].rep + "')")
////                                        .attr("onmouseout", 'd3.select(d' + district + ').attr("fill", "#ffffff")');
//                            })
//                            .attr("d", geoPath);
//                });
//                console.log(repModel);

            }
        };
        xhttp.open("GET", ncSenateURL, true);
        xhttp.send();
    }
//    getSenData();

    function getRepCongressData() {
        var repCongressModel = {};
        ncCongressReps.results.forEach(function(rep){
            repCongressModel[rep.district] = {"party": rep.party, "rep": rep.name};
        });
        console.log(repCongressModel)
        d3.json("ncsgeo/ncdccongressdistrictsmin.json", function (json) {
            gCon.selectAll("path")
                    .data(json.features)
                    .enter()
                    .append("path")
                    .attr("stroke", "#222222")
                    .each(function(d, i) {
                        var district = d.properties.District;
                        d3.select(this)
                                .attr("id", "dcr" + district)
                                .attr("fill", getPartyColor(repCongressModel[district].party))
                                //                                        .attr("onmouseover", 'd3.select(d' + district + ').attr("fill", "' + democratColor + '")')
                                .attr("onclick", "console.log('" + repCongressModel[district].rep + "')")
//                                        .attr("onmouseout", 'd3.select(d' + district + ').attr("fill", "#ffffff")');
                    })
                    .attr("d", geoPath);
        });
    }

//    getRepCongressData();

//    features.properties.districts for district numbers

//    g.selectAll( "path" )
//            .data( neighborhoods_json.features )
////            .data( neighborhoods_json.geometries )
//            .enter()
//            .append( "path" )
//            .attr( "fill", "#ffffff" )
//            .attr("stroke", "#888888")
////            .each(function(d, i) {
////                d3.select(this)
//////                    .attr("id", countyNames[i])
////                        .attr("id", "c" + i)
////                        .attr("onmouseover", 'd3.select(c' + i + ').attr("fill", "' + democratColor + '")')
//////                        .attr("onmouseover", "console.log(countyNames[" + i + "])");
////                        .attr("onmouseout", 'd3.select(c' + i + ').attr("fill", "#ffffff")');
////
////            })
//            .attr( "d", geoPath );



//    var width  = 1400;
//    var height = 600;
//
//    var vis = d3.select("body").append("svg")
//            .attr("width", width).attr("height", height)
//
//    d3.json("ncsgeo/ncrepdistrictsmin.json", function(json) {
//        // create a first guess for the projection
//        var center = d3.geo.centroid(json)
//        var scale  = 150;
//        var offset = [width/2, height/2];
//        var projection = d3.geo.mercator().scale(scale).center(center)
//                .translate(offset);
//
//        // create the path
//        var path = d3.geo.path().projection(projection);
//
//        // using the path determine the bounds of the current map and use
//        // these to determine better values for the scale and translation
//        var bounds  = path.bounds(json);
//        var hscale  = scale*width  / (bounds[1][0] - bounds[0][0]);
//        var vscale  = scale*height / (bounds[1][1] - bounds[0][1]);
//        var scale   = (hscale < vscale) ? hscale : vscale;
//        var offset  = [width - (bounds[0][0] + bounds[1][0])/2,
//            height - (bounds[0][1] + bounds[1][1])/2];
//
//        // new projection
//        projection = d3.geo.mercator().center(center)
//                .scale(scale).translate(offset);
//        path = path.projection(projection);
//
//        // add a rectangle to see the bound of the svg
//        vis.append("rect").attr('width', width).attr('height', height)
//                .style('stroke', 'black').style('fill', 'none');
//        console.log(json)
//        vis.selectAll("path").data(json.features).enter().append("path")
//                .attr("d", path)
//                .style("fill", "white")
//                .style("stroke-width", "1")
//                .style("stroke", "black")
//    });





//    var width  = 1400;
//    var height = 600;
//
//    var vis = d3.select("body").append("svg")
//            .attr("width", width).attr("height", height)
//
//    d3.json("ncsgeo/ncrepdistrictsmin.json", function(json) {
//        // create a first guess for the projection
//        var center = d3.geo.centroid(json)
//        var scale  = 150;
//        var offset = [width/2, height/2];
//        var projection = d3.geo.mercator().scale(scale).center(center)
//                .translate(offset);
//
//        // create the path
//        var path = d3.geo.path().projection(projection);
//
//        // using the path determine the bounds of the current map and use
//        // these to determine better values for the scale and translation
//        var bounds  = path.bounds(json);
//        var hscale  = scale*width  / (bounds[1][0] - bounds[0][0]);
//        var vscale  = scale*height / (bounds[1][1] - bounds[0][1]);
//        var scale   = (hscale < vscale) ? hscale : vscale;
//        var offset  = [width - (bounds[0][0] + bounds[1][0])/2,
//            height - (bounds[0][1] + bounds[1][1])/2];
//
//        // new projection
//        projection = d3.geo.mercator().center(center)
//                .scale(scale).translate(offset);
//        path = path.projection(projection);
//
//        // add a rectangle to see the bound of the svg
//        vis.append("rect").attr('width', width).attr('height', height)
//                .style('stroke', 'black').style('fill', 'none');
//        console.log(json)
//        vis.selectAll("path").data(json.features).enter().append("path")
//                .attr("d", path)
//                .style("fill", "red")
//                .style("stroke-width", "1")
//                .style("stroke", "black")
//    });





//    console.log(

//    console.log(countyNames);


//    d3.select("path#c0").attr( "fill", "#220099" );

//console.log(neighborhoods_json.features[10]);
//            neighborhoods_json.features[0].properties.name
//    );
</script>
</body>
</html>